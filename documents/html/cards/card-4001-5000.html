<script>

    let fullTexts = {};
    let minTexts = {};
    
    let sites = ['Reverso','Google','Linguee','Cambridge','Deepl','Yandex'];
    let sitesWithMin = ["Reverso","Google","Linguee"];
    let sitesOnlyFull = ['Cambridge','Deepl','Yandex'];
    
    class SetTexts {
        configAllFullSpanText(){
            for(let site of sites)
                fullTexts[site] = this.getSpanText(site);
        }
        configAllMinSpanText(){
            for(let site of sitesWithMin)
                minTexts[site] = this.getMinText(site);
            for(let site of sitesOnlyFull)
                minTexts[site] = this.getFullText(site);
        }
        getSpanText(site){
            return document.getElementById('dv'+site).querySelector('span').innerText;
        }
        setSpanText(site, text){
            document.getElementById('dv'+site).querySelector('span').innerText = text;
        }
        getSpanHtml(site, html){
            return document.getElementById('dv'+site).querySelector('span').innerHTML;
        }
        setSpanHtml(site, html){
            document.getElementById('dv'+site).querySelector('span').innerHTML = html;
        }
        getMinText(site) {
            if(typeof site == "object")
                site = site.constructor.name;
            let content = fullTexts[site];
            let comma1, comma2, comma3, comma4 = '';
            if (content != '') {
                comma1 = content.indexOf(',');
                if(comma1==-1) {
                    comma1 = content.length;
                }
                comma2 = content.indexOf(',',comma1+1);
                if(comma2==-1) {
                    comma2 = content.length;
                }
                comma3 = content.indexOf(',',comma2+1);
                if(comma3==-1) {
                    comma3 = content.length;
                }
                comma4 = content.indexOf(',',comma3+1);
                if(comma4==-1) {
                    comma4 = content.length;
                }
                content =  content.substring(0,comma4);
            }
            return content;
        }
        getFullText(site){
            return fullTexts[site];
        }
    }
    
    class HighFrequency {
        constructor(site) {
            this.site = site;
        }
        _getFrequencies(content) {
            let lRound=-1;
            let rRound=-1;
            let frequencies = [];
            while(true) {
                lRound = content.indexOf('(',lRound+1);
                rRound = content.indexOf(')',rRound+1);
                if(lRound == -1) {
                    return frequencies;
                }
                let freq = content.substring(lRound+1,rRound);
                freq = parseInt(freq);
                frequencies.push(freq);
            }
        }
        _getMainFrequencies() {
            let content = minTexts[this.site.constructor.name];
            if (content == '')
                return [];
            else
                return this._getFrequencies(content);
        }
        higherFrequencies() {
            let frequencies = this._getMainFrequencies();
            return this.site._higherFrequencies(frequencies);
        }
    }
    class Reverso extends SetTexts {
        higherFrequencies(){
            let high = new HighFrequency(this);
            return high.higherFrequencies();
        }
        _higherFrequencies(frequencies) {
            let anterior = 0;
            let highers = [];
            for(let freq of frequencies){
                if( (anterior/3) > freq){
                    return highers;
                }
                highers.push(freq);
                anterior = freq;
            }
            return highers;
        }
        getMinText(){
            return super.getMinText(this);
        }
        getFullText(){
            return fullTexts[this.constructor.name];
        }
        bolders(){
            let high = new HighFrequency(this);
            let freq = high.higherFrequencies();
            let mintxt = this.getMinText();
            let i = -1;
            freq.forEach((f) => {
                i = mintxt.indexOf('('+f+')',i+1);
            });
            i = mintxt.indexOf(',',i);
            if(i==-1)
                i = mintxt.length;
            let bolds = mintxt.substring(0,i+1);
            let others = mintxt.substring(i+1,mintxt.length);
            return `<b>${bolds}</b>${others}`;
        }
    };
    class Google extends SetTexts {
        higherFrequencies(){
            let high = new HighFrequency(this);
            return high.higherFrequencies();
        }
        _higherFrequencies(frequencies) {
            let highers = [];
            for(let freq of frequencies){
                if(freq==3)
                    highers.push(freq);
            }
            return highers;
        }
        getMinText(){
            return super.getMinText(this);
        }
        getFullText(){
            return fullTexts[this.constructor.name];
        }
        bolders(){
            let high = new HighFrequency(this);
            let freq = high.higherFrequencies();
            let mintxt = this.getMinText();
            let i = -1;
            freq.forEach(() => {
                i = mintxt.indexOf('(3)',i+1);
            });
            i = mintxt.indexOf(',',i);
            let bolds = mintxt.substring(0,i+1);
            let others = mintxt.substring(i+1,mintxt.length);
            return `<b>${bolds}</b>${others}`;
        }
    };
    class Linguee extends SetTexts {
        getMinText(){
            return super.getMinText(this);
        }
        getFullText(){
            return fullTexts[this.constructor.name];
        }
    };
    
    let texts = new SetTexts();
    texts.configAllFullSpanText();
    texts.configAllMinSpanText();
        
    </script>
        
        <div style="text-align:center;">
            <font color="#3ff"><b>{{word}}</b></font><br>
        </div>
        <hr>
        
        <font color="#3ff"><b>reverso:</b></font>
        <button  id="btReversoMax" style="display:inline">+</button>
        <div  id="dvReverso" style="display:inline">{{reverso}} <button id="btReversoMin">-</button></div>
        
         <br>
        <font color="#3ff"><b>google:</b></font>
        <button id="btGoogleMax" style="display:inline">+</button>
        <div id="dvGoogle" style="display:inline">{{google}} <button id="btGoogleMin">-</button></div>
        
        <br>
        <font color="#3ff"><b>linguee:</b></font>
        <button id="btLingueeMax" style="display:inline">+</button>
        <div id="dvLinguee" style="display:inline">{{linguee}} <button id="btLingueeMin">-</button></div>
    
        <br>
        <font color="#3ff"><b>cambridge:</b></font>
        <button id="btCambridgeMax" style="display:inline">+</button>
        <div id="dvLinguee" style="display:inline">{{cambridge-pt}} <button id="btCambridgeMin">-</button></div>
        
        <br>
        <font color="#3ff"><b>deepl:</b> </font><div id="dvDeepl" style="display:inline">{{deepl}}</div>
    
        <br>
    
        <font color="#3ff"><b>yandex:</b> </font>
        <button id="btYandexMax">+</button>
        <div id="dvYandex" style="display:none">
            {{yandex-pt}}<button id="btYandexMin">-</button>
        </div>
    
        <hr>
        <font color="#3ff"><b>uk-ipa:</b></font> [{{yandex-en-uk-ipa}}]{{howjsay-mp3}}
        <br>
        <font color="#3ff"><b>us-ipa:</b></font> [{{tophonetic-en-us-ipa}}]{{en-us-mp3}}
        <hr>
    
    
        <div style="text-align:center;">
             <font color="#3ff"><b>phrases:</b></font> 
        </div>
         <button id="btPhrasesMax">+</button>
         <button id="btPhrasesMin" style="display:none">-</button>
         <br>
        <div id="dvPhrases" style="display:none">
            <hr>
            <font color="#3ff"><b>english:</b></font>
            <br>
            <span id="enPhrases">{{en-phrases}}</span>
            <hr>
            <font color="#3ff"><b>portuguese:</b></font>
            <br>
            <span id="ptPhrases">{{pt-phrases}}</span>
        </div>
    
    <script>
        window.onload = loadScripts();
    </script>